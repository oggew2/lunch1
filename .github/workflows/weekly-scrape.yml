name: Weekly Menu Scrape
on:
  schedule:
    - cron: '0 6 * * 1'  # Monday 6 AM UTC = 7 AM CET
  workflow_dispatch:

jobs:
  warm-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render service
        run: |
          curl -s "https://lunch1-1.onrender.com/version" || true
          sleep 60
      
      - name: Clear Render cache
        run: curl -s "https://lunch1-1.onrender.com/clear-cache"
      
      - name: Warm edge cache - Kista
        run: curl -sf --max-time 180 "https://lunch1.vercel.app/api/menu?restaurant=kista"
        
      - name: Warm edge cache - Courtyard
        run: curl -sf --max-time 180 "https://lunch1.vercel.app/api/menu?restaurant=courtyard"
        
      - name: Warm edge cache - Time Building
        run: curl -sf --max-time 180 "https://lunch1.vercel.app/api/menu?restaurant=timebuilding"
