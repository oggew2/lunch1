name: Weekly Menu Scrape
on:
  schedule:
    - cron: '0 6 * * 1'  # Monday 6 AM UTC = 7 AM CET
  workflow_dispatch:

env:
  VERCEL_URL: ${{ vars.VERCEL_URL || 'https://lunch1.vercel.app' }}

jobs:
  warm-cache:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Render service
        run: |
          curl -s "https://lunch1-1.onrender.com/version" || true
          sleep 60
      
      - name: Clear Render cache
        run: curl -s "https://lunch1-1.onrender.com/clear-cache"
      
      # Hit Vercel API to populate EDGE cache
      - name: Warm Vercel edge cache - Kista
        run: curl -sf --max-time 180 "${{ env.VERCEL_URL }}/api/menu?restaurant=kista"
        
      - name: Warm Vercel edge cache - Courtyard
        run: curl -sf --max-time 180 "${{ env.VERCEL_URL }}/api/menu?restaurant=courtyard"
        
      - name: Warm Vercel edge cache - Time Building
        run: curl -sf --max-time 180 "${{ env.VERCEL_URL }}/api/menu?restaurant=timebuilding"
